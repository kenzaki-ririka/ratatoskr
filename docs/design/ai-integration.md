# AI 集成与协议设计

## 目标
- 将聊天上下文提交至 AI 服务，返回若干候选回复（默认 3 条；可扩展）。
- 保证隐私、安全与稳定性，提供失败兜底。

## API 形态
- 客户端：Android 本地模块（建议使用 OkHttp/Retrofit）。
- 服务端：可选你已有的推理服务；此处定义通用协议。

## 请求协议
```json
{
  "context": "最近聊天上下文（已截断去重）",
  "style": {
    "safe": 0.5,
    "proactive": 0.3,
    "humor": 0.2
  },
  "limit": 3,
  "locale": "zh-CN"
}
```

## 响应协议
```json
{
  "options": [
    {"label": "稳妥", "text": "您好，我理解您的顾虑…"},
    {"label": "推进", "text": "如果可以的话我们这周…"},
    {"label": "幽默", "text": "我已经准备好社恐免疫徽章…"}
  ],
  "meta": {"latency_ms": 620}
}
```

## 超时与重试
- 客户端超时：1.5–2.0s；失败后展示本地兜底候选并提供刷新。
- 重试策略：指数退避最多 2 次；避免风暴请求。

## 隐私与安全
- 最小化上下文：仅发送必要窗口文本；支持脱敏与本地生成配置。
- 传输安全：HTTPS/TLS；鉴权采用短期 Token。
- 日志：不记录原始上下文；存匿名化统计（耗时、点击率）。

## 指标与治理
- 端到端延迟、成功率、候选点击率。
- 错误分类：网络、解析、服务拒绝（限流/配额）、空响应。

## 备选方案
- 本地模型：设备性能允许下可运行轻量模型，离线生成。
- 混合模式：优先远端，失败时切本地兜底。
